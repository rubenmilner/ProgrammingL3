<!doctype html>

<head>
  <title>Game</title>
  <script src="Player.js"></script>
  <script src="Enemy.js"></script>
  <script src="Bomb.js"></script>
  <script src="Terrain.js"></script>
</head>

<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
</body>

<script>
  var canvas, canvasContext;

  window.onload = function () {
    canvas = document.getElementById("gameCanvas");
    canvasContext = canvas.getContext("2d");

    document.addEventListener('keydown', keyPressed)
    document.addEventListener('keyup', keyReleased)

    setInterval(mainloop, 1000 / 50);
  }
  //player vars
  var pXpos = 0;
  var pYpos = 0;
  var pXspeed = 5;
  var pYspeed = 5;
  const P_SIZE = 20;

  //key codes
  const UP_KEY = 87;
  const DOWN_KEY = 83;
  const LEFT_KEY = 65;
  const RIGHT_KEY = 68;
  const SPACE_KEY = 32;
  var upPressed = false;
  var downPressed = false;
  var leftPressed = false;
  var rightPressed = false;
  var spacePressed = false;

  var player = new Player(pXpos, pYpos, P_SIZE, P_SIZE, 'black', pXspeed, pYspeed);

  var setUp = true;


  function mainloop() {
    if (setUp) {
      for (var i = 0; i < 5; i++) {
        createEnemy();
      }
      createTerrain();
      setUp = false;
    }

    

    colorRect(0, 0, canvas.width, canvas.height, "blue");
    player.drawRect();
    player.playerMove();

    land.forEach(function (terrain, i, array) {
        terrain.drawRect();
      });

      if (enemies.length > 0) {
      enemies.forEach(function (enemy, i, array) {
        enemy.drawRect();
        enemy.enemyMove();

      });
    }

    }


    function keyPressed(evt) {
      if (evt.keyCode == UP_KEY) {
        upPressed = true;
      }
      if (evt.keyCode == DOWN_KEY) {
        downPressed = true;
      }
      if (evt.keyCode == LEFT_KEY) {
        leftPressed = true;
      }
      if (evt.keyCode == RIGHT_KEY) {
        rightPressed = true;
      }
      if (evt.keyCode == SPACE_KEY) {
        spacePressed = true;
      }
    }

    function keyReleased(evt) {
      if (evt.keyCode == UP_KEY) {
        upPressed = false;
      }
      if (evt.keyCode == DOWN_KEY) {
        downPressed = false;
      }
      if (evt.keyCode == LEFT_KEY) {
        leftPressed = false;
      }
      if (evt.keyCode == RIGHT_KEY) {
        rightPressed = false;
      }
      if (evt.keyCode == spacePressed) {
        spacePressed = false;
      }
    }


    var land = [];

    function createTerrain() {
      //terrain vars
      var tXpos = 0;
      var tYpos = canvas.height;
      const T_XSIZE = 800;
      var tYsize = Math.floor(Math.random() * (-100 + -80) - 100);

      var terrain = new Terrain(tXpos, tYpos, T_XSIZE, tYsize, 'green');

      console.log(tYsize);
      land.push(terrain);
    }

    var enemies = [];

    function createEnemy(){
      //enemy vars
      var eXpos = 50;
      var eYpos = 20;
      var eXspeed = 10;
      var eYspeed = 10;
      const eSize = 10;

      var enemy = new Enemy(eXpos, eYpos, eSize, eSize, 'cyan', eXspeed, eYspeed);

      enemies.push(enemy);
    }


    function colorRect(x, y, w, h, c) {
      canvasContext.fillStyle = c;
      canvasContext.fillRect(x, y, w, h);
    }
</script>